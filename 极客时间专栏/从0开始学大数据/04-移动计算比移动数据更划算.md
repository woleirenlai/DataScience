# 04-移动计算比移动数据更划算

如何存储、计算、传输大规模数据是大数据技术架构设计要考虑的核心要素  

传统的软件计算处理模型：输入→计算→输出

对于PB级的数据如何计算采用分布式集群的解决方案，用数千台数万台的计算机构建一个大数据计算处理集群，利用更多的网络带宽、内存空间、磁盘容量、CPU核心数进行计算处理大数据的处理通常是针对网站的存量数据  
也就是例如某个网站全部用户在一段时间内请求产生的数据，这些数据之间有大量关联，网站大数据系统要做的就是将这些统计规律和关联关系计算出来，并进一步改善网站的用户体验的运营决策。

对于这种计算场景的解决方案核心思路是，将程序分发到数据所在的地方进行计算，也就是所谓的移动计算比移动数据更划算。

计算机领域，之前的处理逻辑：一台服务器不够用就升级小型机，不够就升级中型机，不够就升级大型机，升级超级计算机而不是一台计算机的处理能力不能满足计算要求的时候，用两台计算机处理。

大型互联网公司网站每天需要处理十亿次级别的用户请求，产生上百pb级别的数据，不可能有一台计算机能支撑起这么大的计算需求。所以现在是一台不够，就加一台，还不够，就再加一台。

但是新旧两台计算机想要合作构成一个系统，就必须要在技术上重新架构，就是互联网企业广泛采用的负载均衡、分布式缓存、分布式数据库、分布式服务等等

分布式技术满足互联网日常业务需求后，对离线数据和存量数据的处理需求就被提出。

移动计算程序到数据所在位置进行计算的大致实现方法：  
1.将待处理的大规模数据存储在服务器集群的所有服务器上，主要使用HDFS，将文件分成很多块block，以块为单位存储在集群的服务器上。  
2.大数据引擎根据集群里不同服务器的计算能力，在每台服务器上启动若干个分布式任务进程，这些进程会等待给他们分配执行任务。  
3.使用大数据计算框架支持的编程模型进行编程，例如Hadoop的MapReduce模型、spark的rdd模型，编写完成后打包，MapReduce和spark都是在jvm环境中运行，打包出来是Java的jar包。  
4.Hadoop或者spark的启动命令这个jar包，执行引擎解析程序要处理的数据输入路径，根据输入数据量的大小，将数据分成若干片split，每个数据片都分配给一个任务执行进程去处理。  
5.任务执行进程收到任务，检查自己是否有任务对应的程序包，没有就去下载，下载后通过反射的方式架在程序，移动计算完成。  
6.加载程序后，任务执行进程根据分配的数据片文件地址和数据在文件内的偏移量读取数据，并把数据输入给应用程序相应的方法去执行，从而是现在分布式服务器集群中移动计算程序，对大规模数据进行并行处理的计算目标。

互联网应用系统架构中的重要原则：尽量使用无状态的服务，不同服务实例之间不共享状态，也就是不持有数据，用户请求交给任何一个服务实例计算，处理的结果都是一样的。因为无状态服务的主要好处就是服务间无须同步状态或者数据，便于扩缩容。

