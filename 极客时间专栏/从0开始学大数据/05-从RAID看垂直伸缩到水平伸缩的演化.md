# 05-从RAID看垂直伸缩到水平伸缩的演化

大数据技术要解决的是大规模数据的计算处理问题，但是首先要解决的是大规模数据的存储问题。

如果一个文件的大小超过了一张磁盘的大小，单机时代的解决方法是RAID

分布式时代，主要解决方案是分布式文件系统。

大规模数据存储都要解决三个方面的核心问题：  
1.数据存储容量问题，一般服务器的磁盘容量通常是1-2tb，但是每天通常会产生pb级别的数据。  
2.数据读写速度的问题，一般磁盘连续读写数据都是几十mb，pb级别的数据要读很久  
3.数据可靠性问题，磁盘寿命通常为1年，磁盘损坏怎么办对应的解决方案就是RAID技术

RAID（独立硬盘冗余阵列）技术   --   https://zh.wikipedia.org/wiki/RAID 是将多块磁盘组成一个阵列，共同对外提供服务，目的是为了改善磁盘的存储容量，读写速度，增强磁盘的可用性和容错能力。

目前服务器级别的计算机都支持插入8+的磁盘，通过RAID技术，实现数据在多块磁盘上的并发读写和数据备份。

常用的RADI有这几种：raid0 raid1 raid10 raid5 raid6 

假设服务器有N块磁盘

RAID 0是数据从内存缓冲区写入磁盘时分成N分数据，同时并发写入N块磁盘，是的数据整体写入速度是一块磁盘的N倍，读取数据同理，因此RAID 0具有极快的读写速度，但是RAID 0不做数据备份，N块中有一块损坏，数据完整性就被破坏，其他磁盘的数据也无法使用。

RAID 1是数据写入时，将一份数据同时写入两块磁盘，这样任何一块磁盘损坏都不会导致数据丢失，插入一块新磁盘就可以通过复制数据的方式自动修复，可靠性很高。

RAID 10 是RAID 0 和RAID 1方案的结合，将所有磁盘N平均分成两份，数据同时在两份磁盘写入，相当于RAID 1，平均分成两份，在每一份磁盘里面（N/2块磁盘）里面，使用RAID 0技术并发读写，这样既可以提高可靠性有改善性能，但是RAID 10的磁盘利用率较低，有一半的磁盘用来备份数据。

但是一般情况下一个服务器上很少出现两块磁盘同时损坏的情况，如果一块磁盘损坏时可以利用其它磁盘的数据恢复损坏磁盘的数据，就可以在保证可靠性和性能同时提高磁盘利用率。

RAID 3可以在数据写入磁盘的时候，将数据分成N - 1份，并发写入N - 1块磁盘，并在第N块磁盘记录校验数据，如果任何一块磁盘损坏，包括校验数据磁盘，都可以利用其它N - 1块磁盘的数据修复。但是在数据修改较多的场景中，任何磁盘数据的修改都会导致第N块磁盘重写校验数据，导致第N块磁盘比其它磁盘更容易损毁，需要频繁更换，因此RAID 3在实践中很少使用。

RAID 5是RAID 3相似的方案，使用更多，校验数据不是写入第N块磁盘，而是螺旋式的写入所有磁盘，这样校验数据的修改也被平均到所有磁盘上，避免了频繁写坏一块磁盘的情况。

如果数据需要很高的可靠性，在出现同时损坏来给你块磁盘的情况下，或者坏了一块磁盘迟迟没有更换，导致有坏了一块，扔需要修复，可以使用RAID 6，与RAID 5类似，但是数据只写入N - 2块磁盘，并螺旋式地在两块磁盘中写入校验信息（使用不同算法生成）。

在相同磁盘数目N的情况下，各种RAID技术的比较：

RAID技术可以通过专用的RAID卡或者主板直接进行硬件实现，也可以在从操作系统层面将多块磁盘组成RAID，从逻辑上看做一个访问目录。

RAID技术如何解决那三个核心问题：

1.数据存储容量问题。使用N块磁盘构成一个存储阵列，使用RAID 5就可以存储在N - 1块磁盘上，将存储空间扩大了N - 1倍。

2.读写速度问题。RAID可以根据可使用的磁盘数量将待写入的数据分片，并发同时对多个磁盘写入、读取，但是机械磁盘的访问延迟主要来自于寻址时间，数据真正进行读写的时间可能只占据整个数据访问时间的一小部分，因此数据分片N块磁盘并发读写不能将访问速度提高N倍。

3.数据可靠性问题。使用 RAID 10 , RAID 5, RAID 6方案时，数据有存储校验信息，磁盘损坏可以通过其他磁盘上的数据和校验数据进行还原。

计算机领域中实现更强的计算能力和更大规模的数据存储有两种思路：

升级计算机：垂直伸缩 scaling up，通过升级CPU内存磁盘让一台计算机变强  
分布式系统：水平伸缩 sacling out，添加更多的计算机到系统中，实现更强大的计算能力

早期主要靠垂直伸缩提升计算能力，摩尔定律（每18个月处理能力提升一倍）+计算机体系结构的不断研究（小型机、中型机、大型机、超级计算机）

互联网时代，垂直伸缩的路子受成本和超强几圈资源需求限制，走向水平伸缩。

RAID是垂直伸缩，一台计算机集成更多的磁盘实现更大规模、更安全可靠的存储以及更快的访问速度HDFS是水平伸缩，通过添加更多的服务器实现数据更大、更快、更安全的存储和访问

垂直伸缩总有尽头，水平伸缩理论上没有止境

RAID是在单台服务器上多块磁盘组成阵列，将这个思想原理应用到分布式服务器集群，形成了Hadoop分布式文件系统HDFS的架构思想

传统机械磁盘进行数据连续写入时（磁盘以日志格式连续写入操作），其写入速度元大于磁盘随机写入速度（关系数据库连续更新若干条数据记录），原因是

连续写入：写入只寻址一次，存储位置与逻辑位置相邻，不用多次寻址

随机写入：每写一次便寻址一次，增加了磁盘的寻址时间