# 06-设计可复用的数据模型

业务数据分析通常需要根据报表来做，在数据中台构建之前，分析师会经常发现自己五可复用数据，不得不使用原始数据进行清洗、加工和计算指标。  
但是多数写的SQL较差，多层嵌套的SQL对资源消耗很大，造成对列阻塞影响其他数仓任务，数据开发不满，要收回原始数据读取权限，但是分析师抱怨数仓数据不完整，一个需求等一周半个月。

这个矛盾的根源在于数据模型无法复用，数据开发是烟囱式的，新的需求都是原始数据重新计算。

## 好的数据模型设计标准

一个基于元数据中心的血缘关系对大数据平台运行的任务和分析查询（Ad-hoc）进行的统计：

![01](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/06/01.jpg)

1.离线调度任务/表统计

![02](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/06/02.jpg)

2.一周内Ad-hoc查询统计

数仓架构图

![03](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/06/03.jpg)

表 1 中有 2547 张未识别分层的表，占总表 6049 的 40%，它们基本没办法复用。  
在已识别分层的读表任务中，ODS：DWD：DWS：ADS 的读取任务分别是 1072：545：187：433，直接读取 ODS 层任务占这四层任务总和的 47.9%，即有大量任务都是基于原始数据加工，中间模型复用性很差。

表2在已识别的分层的查询中，ODS：DWD：DWS：ADS 的命中的查询分别是 892：1008：152：305，有 37.8% 的查询直接命中 ODS 层原始数据，说明 DWD、DWS、ADS 层数据建设缺失严重。  
尤其是 ADS 和 DWS查询越底层的表，会导致查询扫描的数据量越大，查询时间越长，资源消耗也越大，数据使用满意度低。

在对 ODS 层被读取的 704 张表进行分解，发现有 382 张表的下游产出是 DWS，ADS，尤其是 ADS 达到了 323 张表，占 ODS 层表的比例 45.8%，也就是大量 ODS 层表被进行物理深加工。

根据这个统计，一个理想的数仓模型应该具备的因素：**模型可服用、完善且规范**。

![04](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/06/04.jpg)