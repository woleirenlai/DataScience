# 03-数据中台的方法论、组织和技术

把建数据中台比作是盖房子，数据中台建设的方法论是数据图纸；数据中台的支撑技术是工具；数据中台的组织架构是施工队，三者缺一不可。

## 数据中台建设方法论

2016 年，阿里巴巴就提出了数据中台建设的核心方法论：OneData 和 OneService。

### OneData

OneData 的话就是所有数据只加工一次。

![03-1](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/03/03-1.jpg)

​	供应链团队已经计算出了商品的库存，市场部门也需要，两个数据需求同时开发，费时效率低。

数据中台需要在整个大业务形成一个公共数据层，消灭跨部门的小数仓，实现数据的复用，所以强调数据只加工一次，不会因为不同的应用场景，不同的部门数据重复加工。

具体实现怎么做：

* 分主题域管理
* 命名规范定义
* 指标一致
* 数据模型复用
* 数据完善

构建了数据中台，但存在几万张表，同时又有几十个数据开发维护这些表，划主题域可以有效保证这些表的管理效率。  
将这几万张表划到不同的主题域中，比如在电商业务中，商品、交易、流量、用户、售后、配送、供应链都可以作为主题域。

**好的主题域划分，是相对稳定，尽可能地覆盖绝大多数的表。**

**对表名明进行规范化统一**，表的名称中最好能够携带表的主题域、业务过程、分层以及分区信息。  
比如，仓储域下的一张入库明细表，规则命名可以为：

![03-7](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/03/03-7.jpg)

**构建全局的指标字典**，确保所有表中相同指标口径必须一致。

![03-3](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/03/03-3.jpg)

另外为了实现模型的复用，数据中台适合采用分层的设计方式，常见的分层：  
ODS 原始数据层，DWD 明细数据层，DWS 轻度汇总数据层，ADS/DM 应用数据层 / 数据集市层。

最后，数据中台的数据必须尽可能的覆盖所有的业务过程，数据中台中每一层的数据也要尽可能完善，让数据使用者尽可能的使用汇总后的数据。

OneData 体系的目标是构建统一的数据规范标准，让数据成为一种资产，而不是成本。  
**资产和成本的差别在于资产是可以沉淀的，是可以被复用的。成本是消耗性质的、是临时的、无法被复用的。**

### OneService

OneService 数据即服务，强调数据中台中的数据应该是通过 API 接口的方式被访问。

不通过 API 接口，直接提供数据表给用户会存在一些问题。

比如开发一个数据产品，首先需要把数据导入到不同的查询引擎。

* 数据量小的使用 MySQL；
* s数据量大可能用到 HBase；
* 需要多维分析的可能需要 Greenplum；
* 实时性要求高的需要用到 Redis；

不同的查询引擎，应用开发需要定制不同的访问接口，当某个任务无法按时产出，发生异常时，想要了解这个表可能会影响到下游的哪些应用或者报表，但是却发现单纯依赖表与表的血缘无法触及应用，根本无法知道最后的这些表被哪些应用访问。同时，想下线一张表时，也不知道谁访问了这张表，就无法实施，最终造成了“上线容易，下线难”的窘境。

数据服务化的实现：

* 屏蔽异构数据源
* 数据网关
* 逻辑模型
* 性能和稳定性

**屏蔽异构数据源**  
数据服务必须要能够支撑类型丰富的查询引擎，满足不同场景下数据的查询需求，常见的有 MySQL、HBase、Greenplum、Redis、Elasticsearch 等。

**数据网关**  
要实现包括权限、监控、流控、日志在内的一系列管控能力，哪个应用的哪个页面访问了哪个模型，要做到实时跟踪，如果有一些模型长时间没有被访问，应该予以下线。  
使用数据的每个应用都应该通过 accesskey 和 secretkey 实现身份认证和接口权限的管理。  
另外访问日志可以方便在访问出现问题时，加快排查速度。

**逻辑模型**  
从用户的视角出发，屏蔽底层的模型设计的实现，面向用户提供逻辑模型。  
逻辑模型可以类比数据库中的视图，视图本身并没有真实的数据，一个视图可以关联一张或者多张表，每次在查询的时候，动态地将不同表的查询结果聚合成视图的查询结果，逻辑模型可以帮助应用开发者屏蔽底层的数据物理实现，实现相同粒度的数据构造一个逻辑模型，简化了数据接入的复杂度。

**性能和稳定性**  
由于数据服务侵入到用户的访问链路，所以对服务的可用性和性能都有很高的要求，数据服务必须是无状态的，可以做到横向扩展。

OneService 体系的目标是提高数据的共享能力，让数据可以被用得好，用得爽。

## 数据中台支撑技术

好的工具可以让数据中台建设事半功倍。

![03-5](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/03/03-5.jpg)

数据中台的支撑技术体系框架，底层以 Hadoop 为代表的大数据计算、存储基础设施，提供了大数据运行所必须的计算、存储资源。

以 HDFS 为代表的分布式文件系统，以 Yarn/Kubernates 为代表的资源调度系统，以 Hive、Spark、Fink 为代表的分布式计算引擎，都属于基础设施范畴。可以比作一个工厂的水、电。

在 Hadoop 之上浅绿色的部分是原有大数据平台范畴内的工具产品，覆盖了从数据集成、数据开发、数据测试到任务运维的整套工具链产品。  
同时还包括基础的监控运维系统、权限访问控制系统和项目用户的管理系统。由于涉及多人协作，所以还有一个流程协作与通知中心。

灰色的部分是数据中台的核心组成：数据治理模块。  
对应的方法论就是 OneData 体系。以元数据中心为基础，在统一了企业所有数据源的元数据基础上，提供了包括数据地图、数仓设计、数据质量、成本优化以及指标管理在内的 5 个产品，分别对应的就是数据发现、模型、质量、成本和指标的治理。

深绿色的部分是数据服务，它是数据中台的门户，对外提供了统一的数据服务，对应的方法论就是 OneService。  
数据服务向下提供了应用和表的访问关系，使数据血缘可以延申到数据应用，向上支撑了各种数据应用和服务，所有的系统通过统一的 API 接口获取数据。

在数据服务之上是面向不同场景的数据产品和应用  
包括面向非技术人员的自助取数系统；面向数据开发、分析师的自助分析系统；面向敏捷数据分析场景的 BI 产品；活动直播场景下的大屏系统；以及用户画像相关的标签工厂。

## 组织架构

各个部门分散的数仓，是因为建设这些数据仓库的人分散在各个业务部门。  
如果要建设数据中台，出了方法论和支撑技术，还必须要有一个独立于业务部门的中台团队。

数据中台提供的是一个跨业务部门共享的公共数据能力，所以，承担数据中台建设职责的部门一定是一个独立于业务线的部门。  
这个部门的负责人应该直接向公司的 CTO 汇报工作，这个也要取决于数据中台建设的层次，例如在网易内，有云音乐、严选等多个产品线，数据中台的建设层次是在产品级别的，也就是说，云音乐有一个数据中台，严选有一个数据中台，所以严选的数据中台应该向严选的 CTO 汇报。

独立部门的最大风险是与业务脱节，所以数据中台的组织定位是：**懂业务，能够深入业务，扎根业务。**  
数据中台要管理所有的指标，而每个业务线之间的指标既有差异，也有交叉，要理解指标的口径定义，就必须要了解业务的过程。同时，当需要制定一些新的指标时，必须要了解各个业务线新的业务目标，指标的本质还是为业务目标服务的。

合适的组织架构：

![03-6](https://github.com/woleirenlai/Images/blob/master/shujuzhongtai/03/03-6.jpg)

* 数据产品部门：负责数据中台、数据产品的体系规划、产品设计、规范制定、应用效果跟进，指标口径的定义和维护（有的部门是由分析师管理）。
* 数据平台部门：负责研发支撑数据中台构建的产品，例如指标系统、元数据中心、数据地图等。
* 数据开发团队：负责维护数据中台的公共数据层，满足数据产品制定的数据需求。
* 应用开发团队：负责开发数据应用产品，比如报表系统、电商中的供应链系统、高层看板、经营分析。

中台组织的绩效目标一定要与业务落地价值绑定的。  
比如在电商中，提供了供应链决策系统，有智能补货的功能，会根据商品的库存，各个地区的历史销售情况，生产加工周期，自动生成补货决策，由人工审核以后，直接推送给采购系统。在评估价值时拿由系统自动生成的采购计划占整体采购计划的比例来衡量数据的应用价值。

最后，数据中台的组织架构改革涉及原有各个部门的利益，所以这个是数据中台构建最难又不得不做的地方，必须要取得高层领导的支持和重视。



* 适合数据中台的组织架构是建设数据中台的第一步，数据中台组织一定是独立的部门，同时要避免与业务脱节，深入业务，要与业务目标绑定。
* 数据中台支撑技术大规模落地，需要有成熟的系统工具作为支撑，同时要注意这些系统工具之间的联动和打通。
* 数据中台的方法论可以借鉴，但是不能完全照搬，每个公司的数据应用水平和当前遇到的问题都不相同，可以针对这些问题，分阶段制定数据中台的建设计划，选择性的应用一些技术，例如当前最主要的问题是数据质量问题，那就应该优先落地数据质量中心，提升质量。

**数据中台的建设绝对不是为了建中台而建中台，数据中台的建设一定要结合落地场景，可以先从从一些小的场景开始，但是规划一定是要有顶层设计的。**

