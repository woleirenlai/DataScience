# 06 选择实验样本量

* A/B 测试所需的时间 = 总样本量 / 每天可以得到的样本量。
* 样本量越小，实验所进行的时间越短。实验会有一定的试错成本，实验范围越小，样本量越小，试错成本越低。
* 样本量n = （（1-α/2对应的Z分数 + Power对应的Z分数））平方 /（实验组和对照组评价指标的差值 / 实验组和对照组的综合方差）平方
* 第二类错误发生的概率为β，Power = 1-β，其本质为概率，在A/B测试中，如果实验组和对照组的指标事实上是不同的，Power指通过A/B测试检测到两者不同的概率。
  * 如果实验组和对照组事实上是不同的，Power越大，说明A/B测试越能准确地检测出两组的不同。
  * 可视为A/B测试的灵敏度。
* 样本量n只和显著水平、Power、实验组和对照组的综合方差、实验组和对照组评价指标的差值有关
  * 显著水平越小，样本量越大，显著水平是第一类错误率，第一类错误率越小，结果越精准，需要的样本量更大。
  * Power越大，样本量越大，Power越大说明第二类错误率β越小。
  * 方差越大，样本量越大，方差越大说明指标的波动范围越大，越不稳定，需要更多的样本来做实验。
  * 差值越小，样本量越大，差值越小说明越不容易被A/B测试检测到，也就需要提高Power。
* 实践中绝大部分A/B测试遵循统计中的惯例：显著水平为5%，Power默认为80%，样本量公式约为8*实验组和对照组的综合方差的平方 / 实验组和对照组评价指标的差值的平方，此样本量为使测试结果达到统计显著性的最小样本量。
* 实验组和对照组的样本量应保持相等，总样本量为以上公式的2倍。
* 实验组和对照组评价指标的差值估算
  * 从收益和成本角度，计算出收支平衡时的差值，希望差值比收支平衡时大即可
  * 从历史数据中，计算评价指标平均值和波动范围，对实验组评价指标的期望值是至少高于这个波动范围。
* 实验组和对照组综合方差计算，选取历史数据
  * 概率类指标通常是二项分布，综合方差 = 对照组中事件发生的概率 * （1-对照组中事件发生的概率）+期望的实验组中事件发生的概率 * （1-期望的实验组中事件发生的概率）
    * 对照组中事件发生的概率是没有A/B测试变化的情况，通过历史数据得出，期望的实验组中事件发生的概率 = 对照组中事件发生的概率+实验组和对照组评价指标的差值
  * 均值类指标通常是正态分布，综合方差 = 2*历史数据样本方差/（历史数据样本大小 - 1）

# 07 分析测试结果

* 只有确定测试结果值得信赖之后才可以进行分析
* 测试时间的确定除了考虑样本量的大小，还需要考虑指标周期性变化的因素
* 样本量未达到预期时达到了统计显著，并不能说明实验成功
  * 样本量不断变化，每次观测到的都可以算是新实验，观测次数的变多，观测得到错误的统计显著结果的概率会提升。
  * 样本量没有达到事先预估的最小样本量得到的统计显著结果极有可能是假阳性。
* 正式分析结果之前进行合理性检验，可以用护栏指标保证统计品质。可以使用实验 / 对照组样本大小的比例和实验 / 对照组中特征的分布这两个护栏指标保证测试结果可信赖。
* 分析 A/B 测试的结果，主要就是对比实验组和对照的评价指标是否有显著不同，显著”就是要排除偶然随机性的因素，通过统计的方法来证明两者的不同是事实存在的，而不是由于波动性造成的巧合。
* 使用统计中的假设检验计算出相关的统计量再分析测试结果，常用统计量为P值和置信区间。
* 评价指标为概率类指标时，一般选用Z检验计算，评价指标为均值类指标且在大样本下可以近似成正态分布时选用T检验计算，评价指标比较复杂且大样本下不能呈正态分布，采用Bootstrapping方法从P值或置信区间定义计算。
* P值法和置信区间法实际中选择一种即可
  * 如果需要考虑实施变化后的收益和成本的关系时，要选择置信区间法了。除了满足结果在统计上是显著：两组指标不相同，差值的置信区间不包括 ，还要让结果在业务上也是显著：两组指标要不相等，而且其差值>收支平衡时差值，且差值的置信区间范围比收支平衡时差值的置信区间范围大。