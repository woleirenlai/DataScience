# 09测试结果不显著的改善

* 实验结果不显著的原因

  * 测试中的变化确实没有效果，两组指标在事实上的相同的
  * 测试的变化有效果，两组指标在事实上是不同的，但是变化程度很小，测试灵敏度Power不足，没有检测到两组指标的不同。

* 通过增加样本量、减小方差提高Power

* 增加样本量的方法

  * 延长测试时间，在时间允许的情况下。

  * 增加测试使用流量在总流量中的占比，适用于时间有限，同时测试时只使用了总流量中很少的一部分。

  * 多个测试共用一个对照组：在同一个基础上想同时验证多个变化，也就是跑多个 A/B 测试有相同的对照组的时候（A/B/n测试），我们可以把对照组合并，减少分组数量，这样每组的样本量也会增加。

* 减少方差的方法
  * 减少指标的方差
    * 保持原指标不变，剔除离群值
    * 选用方差较小的指标，取值范围窄的指标比取值范围广的指标方差要小。概率类指标要比均值类指标的方差小。满足业务需求的情况下可以把均值类指标转化成表征相似行为的概率类指标。
  * 倾向评分匹配PSM
    * 目的是解决实验组和对照组分布不均匀的问题。
    * 两组的各个特征越相似，两组的方差越小
    * 倾向评分越接近，说明两个数据点越相似。其中一个数据点，指 A/B 测试中的一个实验单位。
    * PSM 能够有效地减少两组的方差。通过比较倾向评分匹配后的两组的相似部分，可以来查看结果是否显著。
  * 在触发阶段计算指标
    * 从分配和触发上来看，A/B测试分为变化不需要触发型（所有用户在分配到实验组后，都可以体验到变化），变化需要触发型（分配到实验组的所有用户中，只有满足一定条件的用户才可以体验到变化）。
    * 在触发阶段计算指标，就是在计算指标时只考虑每组符合触发条件的用户，而不是考虑每组中的所有用户。

# 10-11常见误区及解决方法

* 常见误区：多重检验问题、学习效应、辛普森悖论、实验/对照组的独立性
* 多重检验问题
  * 当同时比较多个检验时，第一类错误率alpha就会增大，而结果的准确性就会受到影响
  * 第一类错误率是指当事实上两组指标是相同的时候，假设检验出两组指标不同的概率，也就是由于偶然得到显著结果的概率。
  * 随着检验次数的增加，即同时比较多个检验（测试）时，至少出现一个第一类错误的概率（FWER）会变得很大，alpha越小，FWER会越小，随着检验次数增加的速度也越慢。
  * 多重检验实际出现的场景
    * A/B测试不止有一个实验组：想要改变不止一个变量且样本量充足时，可以同时测试这些变量，把它们分在不同的实验组当中。每个实验组只变化一个变量，在分析结果时分别用每个实验组和共同的对照组进行比较，这种方法也叫做 A/B/n 测试。
    * 不只有一个评价指标
    * 分析测试结果时，按照不同维度去做细分分析
    * 测试进行过程中不断查看实验结果时
  * 多重检验的解决方法：用 P 值来判断假设检验的结果是否显著时，是用检验中计算出的 P 值和alpha进行比较。当 P 值 <alpha时，我们才说结果显著。
    * 保持每个检验的P值不变，调整alpha
      * Bonferroni矫正，将alpha变为alpha/n，n为检验的个数，检验次数较少时适用，较严格和保守。检验次数较大时比如上百次（不同维度的细分分析），会显著增加第二类错误率beta。
    * 保持alpha不变，调整每个检验的P值
      * FDR方法，是一类方法，最常用的是BH法，考虑每个P值的大小然后做不同程度调整，调整的大致方法是把各个检验计算出的 P 值从小到大排序，然后根据排序来分别调整不同的 P 值，最后再用调整后的 P 值和alpha进行比较。
* 学习效应
  * 测试检验非常明显的变化时，老用户学习适应阶段的行为会跟平时有些不同。
    * 积极地反应：新奇效应，老用户对变化有很强的好奇心，愿意尝试
    * 消极的反应：改变厌恶，老用户对变化比较困惑甚至产生抵触情绪。
    * 学习适应期的不同反应一般是短期的，长期来看短期的反应会慢慢消退，但是短期的学习效应会给测试结果带来干扰。
  * 学习效应的检测
    * 表征实验组的指标随着时间（天为单位）的变化情况，实验组的指标会有一个随着时间慢慢变化的过程直到稳定，并不是每天比较实验组和对照组的大小（会出现多重检验问题），只有达到样本量之后才可以比较两组大小，分析测试结果。
    * 只比较实验组和对照组的新用户，对于实验期间才第一次登陆的新用户来说不存在学习适应新变化的过程，在新用户样本量充足的情况下，在新用户的比较中无显著结果，总体比较中出现了显著结果，大概率是出现了学习效应。
  * 通过延长测试时间等到实验组学习效应消退来比较两组的结果。
* 辛普森悖论
  * 当多组数据内部组成分布不均匀时，从总体上比较多组数据和分别在每个细分领域中比较多组数据可能会得出相反的结论。
  * A/B测试中的辛普森悖论是由于实验中两组在不同细分领域中的分布不均造成的。只要是实验组和对照组在任何一个细分领域的分布与实验设计的不相符时，都有可能出现辛普森悖论。
  * 在分析测试结果前做好合理性检验，辛普森悖论出现的几率会大大减少，合理性检验中的检验实验 / 对照组中特征的分布，即检验两组中的特征分布是否相似，是否符合实验设计要求的比例分布。
  * 没有做好合理性检验，最好重跑实验，看不同细分的分布是否消失，没有消失需要检查是否是工程实施问题。无法重跑实验以细分结果为准，但是注意多重检验问题。
* 实验组和对照组相互独立
  * A/B 测试的一个前提：实验组和对照组的实验单位是要相互独立的，即测试中各组实验单位的行为仅受本组体验的影响，不能受其他组的影响。
  * 破坏两组独立性的表现形式
    * 社交网络/通讯类业务
      * 用户之间的交流和信息交换，存在网络效应即网络中相邻的各个节点会相互影响。
      * 实验组A会因为测试中的变化而改变使用行为，这个改变会通过网络效应传递给在对照组的好友B，从而改变了B的使用行为。
    * 共享经济类业务
      * 双边市场，公司只提供交易平台，供给方和需求方均是用户，供需关系动态平衡，一方的变化必然会引起另一方的变化，从而影响实验。
      * 需求侧的优化，在需求侧分成两组，实验组受到优化导致需求增加，在供给一定的情况下，更多的供给流向实验组造成对照组供给减少，通过测试的吃的效果比较对照组会被高估。
    * 共享资源类业务
      * 共享资源来业务有固定的资源或预算。广告营销，按点击次数付费。
      * 实验组和对照组共享预算池。出现实验组枪战对照组预算。
  * 避免破坏两组独立性的方法
    * 通过不同形式的分离排除两组之间的干扰
    * 地理上进行分离：适用于收到地理位置影响的线下服务，常用从城市分类，选取的不同市场要尽量相似，具有可比较性，相似包括但不限于：该项业务在当地的发展情况，当地的经济状况，人口分布情况等等。
    * 资源上进行分离：适用于共享资源造成的两组之间的干扰，需要让每组的资源分配比例和每组样本量的比例一致。
    * 时间上进行分离：适用于不易被用户察觉的变化上，需要实验组和对照组都是同一组用户，在一段时间内实施变化，给他们实验组的体验，然后在另一段时间内不实施变化，给他们对照组的体验。注意时间周期性波动，进行比较式尽量在不同周期的同一个阶段进行比较。
    * 通过聚类方法进行分离：适用于社交网络类业务，通过模型的方法根据不同用户之间交流的程度分离出不同集群，每个集群都有不同的联系很密切的用户，把每个集群作为实验单位随机分组。